<html>
<head>
<title>file_existence.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(0,0,128); font-weight: bold; }
.s3 { color: rgb(0,128,0); font-weight: bold; }
.s4 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
file_existence.js</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">/* jshint mocha: true */</span><span class="s1"> 
 
</span><span class="s2">import </span><span class="s1">assert from </span><span class="s3">'assert'</span><span class="s1">; 
</span><span class="s2">import </span><span class="s1">fs from </span><span class="s3">'fs'</span><span class="s1">; 
</span><span class="s2">import </span><span class="s1">path from </span><span class="s3">'path'</span><span class="s1">; 
</span><span class="s2">import </span><span class="s1">glob from </span><span class="s3">'glob'</span><span class="s1">; 
 
</span><span class="s2">import </span><span class="s1">pkg  from </span><span class="s3">'./../package.json'</span><span class="s1">; 
 
</span><span class="s2">const </span><span class="s1">dirs = pkg[</span><span class="s3">'h5bp-configs'</span><span class="s1">].directories; 
 
</span><span class="s2">const </span><span class="s1">expectedFilesInArchiveDir = [ 
  </span><span class="s3">`</span><span class="s1">${pkg.name}</span><span class="s3">_v</span><span class="s1">${pkg.version}</span><span class="s3">.zip`</span><span class="s1"> 
]; 
 
</span><span class="s2">const </span><span class="s1">expectedFilesInDistDir = [ 
 
  </span><span class="s3">'.editorconfig'</span><span class="s1">, 
  </span><span class="s3">'.gitattributes'</span><span class="s1">, 
  </span><span class="s3">'.gitignore'</span><span class="s1">, 
  </span><span class="s3">'.htaccess'</span><span class="s1">, 
  </span><span class="s3">'404.html'</span><span class="s1">, 
  </span><span class="s3">'browserconfig.xml'</span><span class="s1">, 
 
  </span><span class="s3">'css/'</span><span class="s1">, </span><span class="s0">// for directories, a `/` character</span><span class="s1"> 
  </span><span class="s0">// should be included at the end</span><span class="s1"> 
  </span><span class="s3">'css/main.css'</span><span class="s1">, 
  </span><span class="s3">'css/normalize.css'</span><span class="s1">, 
 
  </span><span class="s3">'doc/'</span><span class="s1">, 
  </span><span class="s3">'doc/TOC.md'</span><span class="s1">, 
  </span><span class="s3">'doc/css.md'</span><span class="s1">, 
  </span><span class="s3">'doc/extend.md'</span><span class="s1">, 
  </span><span class="s3">'doc/faq.md'</span><span class="s1">, 
  </span><span class="s3">'doc/html.md'</span><span class="s1">, 
  </span><span class="s3">'doc/js.md'</span><span class="s1">, 
  </span><span class="s3">'doc/misc.md'</span><span class="s1">, 
  </span><span class="s3">'doc/usage.md'</span><span class="s1">, 
 
  </span><span class="s3">'favicon.ico'</span><span class="s1">, 
  </span><span class="s3">'humans.txt'</span><span class="s1">, 
 
  </span><span class="s3">'icon.png'</span><span class="s1">, 
 
  </span><span class="s3">'img/'</span><span class="s1">, 
  </span><span class="s3">'img/.gitignore'</span><span class="s1">, 
 
  </span><span class="s3">'index.html'</span><span class="s1">, 
 
  </span><span class="s3">'js/'</span><span class="s1">, 
  </span><span class="s3">'js/main.js'</span><span class="s1">, 
  </span><span class="s3">'js/plugins.js'</span><span class="s1">, 
  </span><span class="s3">'js/vendor/'</span><span class="s1">, 
  </span><span class="s3">`js/vendor/jquery-</span><span class="s1">${pkg.devDependencies.jquery}</span><span class="s3">.min.js`</span><span class="s1">, 
  </span><span class="s3">`js/vendor/modernizr-</span><span class="s1">${pkg.devDependencies.modernizr}</span><span class="s3">.min.js`</span><span class="s1">, 
 
  </span><span class="s3">'LICENSE.txt'</span><span class="s1">, 
  </span><span class="s3">'robots.txt'</span><span class="s1">, 
  </span><span class="s3">'site.webmanifest'</span><span class="s1">, 
  </span><span class="s3">'tile-wide.png'</span><span class="s1">, 
  </span><span class="s3">'tile.png'</span><span class="s1"> 
 
]; 
 
</span><span class="s0">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><span class="s1"> 
 
</span><span class="s2">function </span><span class="s1">checkFiles(directory, expectedFiles) { 
 
  </span><span class="s0">// Get the list of files from the specified directory</span><span class="s1"> 
  </span><span class="s2">const </span><span class="s1">files = glob.sync(</span><span class="s3">'**/*'</span><span class="s1">, { 
    </span><span class="s3">'cwd'</span><span class="s1">: directory, 
    </span><span class="s3">'dot'</span><span class="s1">: </span><span class="s2">true</span><span class="s1">,      </span><span class="s0">// include hidden files</span><span class="s1"> 
    </span><span class="s3">'mark'</span><span class="s1">: </span><span class="s2">true      </span><span class="s0">// add a `/` character to directory matches</span><span class="s1"> 
  }); 
 
    </span><span class="s0">// Check if all expected files are present in the</span><span class="s1"> 
    </span><span class="s0">// specified directory, and are of the expected type</span><span class="s1"> 
  expectedFiles.forEach((file) =&gt; { 
 
    </span><span class="s2">let </span><span class="s1">ok = </span><span class="s2">false</span><span class="s1">; 
    </span><span class="s2">const </span><span class="s1">expectedFileType = (file.slice(-</span><span class="s4">1</span><span class="s1">) !== </span><span class="s3">'/' </span><span class="s1">? </span><span class="s3">'regular file' </span><span class="s1">: </span><span class="s3">'directory'</span><span class="s1">); 
 
    </span><span class="s0">// If file exists</span><span class="s1"> 
    </span><span class="s2">if </span><span class="s1">(files.indexOf(file) !== -</span><span class="s4">1</span><span class="s1">) { 
 
      </span><span class="s0">// Check if the file is of the correct type</span><span class="s1"> 
      </span><span class="s2">if </span><span class="s1">(file.slice(-</span><span class="s4">1</span><span class="s1">) !== </span><span class="s3">'/'</span><span class="s1">) { 
        </span><span class="s0">// Check if the file is really a regular file</span><span class="s1"> 
        ok = fs.statSync(path.resolve(directory, file)).isFile(); 
      } </span><span class="s2">else </span><span class="s1">{ 
        </span><span class="s0">// Check if the file is a directory</span><span class="s1"> 
        </span><span class="s0">// (Since glob adds the `/` character to directory matches,</span><span class="s1"> 
        </span><span class="s0">// we can simply check if the `/` character is present)</span><span class="s1"> 
        ok = (files[files.indexOf(file)].slice(-</span><span class="s4">1</span><span class="s1">) === </span><span class="s3">'/'</span><span class="s1">); 
      } 
 
    } 
 
    it(</span><span class="s3">`&quot;</span><span class="s1">${file}</span><span class="s3">&quot; should be present and it should be a </span><span class="s1">${expectedFileType}</span><span class="s3">`</span><span class="s1">, () =&gt;{ 
      assert.equal(</span><span class="s2">true</span><span class="s1">, ok); 
    }); 
 
  }); 
 
  </span><span class="s0">// List all files that should be NOT</span><span class="s1"> 
  </span><span class="s0">// be present in the specified directory</span><span class="s1"> 
  (files.filter((file) =&gt; { 
    </span><span class="s2">return </span><span class="s1">expectedFiles.indexOf(file) === -</span><span class="s4">1</span><span class="s1">; 
  })).forEach((file) =&gt; { 
    it(</span><span class="s3">`&quot;</span><span class="s1">${file}</span><span class="s3">&quot; should NOT be present`</span><span class="s1">, () =&gt; { 
      assert(</span><span class="s2">false</span><span class="s1">); 
    }); 
  }); 
 
} 
 
</span><span class="s0">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><span class="s1"> 
 
</span><span class="s2">function </span><span class="s1">runTests() { 
 
  describe(</span><span class="s3">'Test if all the expected files, and only them, are present in the build directories'</span><span class="s1">, () =&gt; { 
 
    describe(dirs.archive, () =&gt; { 
      checkFiles(dirs.archive, expectedFilesInArchiveDir); 
    }); 
 
    describe(dirs.dist, () =&gt; { 
      checkFiles(dirs.dist, expectedFilesInDistDir); 
    }); 
 
  }); 
 
} 
 
runTests(); 
</span></pre>
</body>
</html>